<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">

<dom-module id="graph-console">
    <template>
        <style>
            .cta {
                position: absolute;
                bottom: 85px;
                right: 5px;

                /* props */
                background: white;
                color: #a0a0a0;
                cursor: pointer;

                z-index: 401;
            }

            .consolePane {
                /* layout */
                position: absolute;
                bottom: -300px;
                z-index: 400;
                display: none;

                /* dims */
                width: 100%;
                height: 300px;

                /* props */
                transition: transform 0.4s, height 0.4s;
                background: #ffffdd;
                border-top: 1px solid #ddd390;

            }

            .consolePane.out {
                transform: translateY(-300px);
            }

            .stdout {
                height: 200px;
                overflow-y: scroll;
            }
            .stdin {
                height: 30px;
            }
        </style>

        <paper-button class="cta" raised="" role="button" tabindex="0">Console</paper-button>

        <div class="consolePane">
            <div id="stdout" class="stdout">
            </div>

            <div class="stdin">
                <paper-input id="stdin" label="">
                    <div prefix>$ </div>
                </paper-input>
            </div>
        </div>

    </template>

    <script>
        Polymer({
            is: 'graph-console',
            paneDisplay: false,
            showPane: function() {
                this.paneDisplay = true;
                var pane = Polymer.dom(this.root).querySelector('.consolePane');
                pane.style.display = 'block';

                setTimeout(function() {
                    pane.classList.add('out');
                }, 5);
            },
            hidePane: function() {
                this.paneDisplay = false;
                var pane = Polymer.dom(this.root).querySelector('.consolePane');
                pane.classList.remove('out');
                setTimeout(function() {
                    pane.style.display = 'none';

                }, 400);
            },
            ctaClickHandler: function() {
                if (this.paneDisplay) {
                    this.hidePane();
                } else {
                    this.showPane();
                }
            },
            sendCommand: function(cmd) {
              console.log('sending command: ', cmd);
              var stdout = this.$.stdout;
              var command = document.createElement('div');
              command.innerHTML = cmd;
              stdout.appendChild(command);
              stdout.scrollTop = stdout.clientHeight;
            },
            stdinKeypressHandler: function(event) {
                var ENTER_CODE = 13;
                if (event.charCode === ENTER_CODE || event.keyCode === ENTER_CODE || event.which === ENTER_CODE) {
                    var input = this.$.stdin;
                    var cmd = input.value;
                    this.sendCommand(cmd);
                    input.value = '';
                }
            },
            ready: function() {
                console.log('graph-console is ready');
                var cta = Polymer.dom(this.root).querySelector('.cta')

                cta.addEventListener('click', this.ctaClickHandler.bind(this));

                var stdin = Polymer.dom(this.root).querySelector('paper-input');
                stdin.addEventListener('keypress', this.stdinKeypressHandler.bind(this));
            }
        })
    </script>
</dom-module>
